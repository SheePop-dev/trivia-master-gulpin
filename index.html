<!DOCTYPE html>
<html>
<body>
  <h1 id="category">Category</h1>
  <p id="question">question</p>
  <button id="answer0" onClick="checkAnswer(0)">0</button>
  <button id="answer1" onClick="checkAnswer(1)">1</button>
  <button id="answer2" onClick="checkAnswer(2)">2</button>
  <button id="answer3" onClick="checkAnswer(3)">3</button>


<script>
// things to add 
// shiny gulpin chance
// fan-made trivia questions
// list of punishments (TOTK Bingo: drop all weapons | unequip all armor for 10 minutes | transfer shiny pokemon to chat | increase chance of Gulpin by 5% permanently | next question is read in jumbled words | buy a salmon | give greg VIP | stop and help 3 koroks | shrine blindfolded | increase voice pitch by 1 octave | curse | bee movie | speak in spanish for 5 minutes | open tart packs | speeddraw a new tart card | 

const soundURL = "https://play.pokemonshowdown.com/audio/cries/gulpin.mp3";
let correctAnswer = "";

async function loadQuestion() {
  document.getElementById("question").innerHTML = "";
  //category, question, incorrect_answers, correct_answer
  const res = await fetch("https://opentdb.com/api.php?amount=1&type=multiple");
  const data = await res.json();
  const q = data.results[0];
  
  const category = decode(q.category);
  const question = decode(q.question);
  const correct_answer = decode(q.correct_answer);
  correctAnswer = correct_answer;
  
  
  
  
  let all_answers = q.incorrect_answers.map(a => decode(a));
  all_answers.push(correct_answer);
  all_answers = shuffle(all_answers);

  
  document.getElementById("category").innerHTML = category;
  
  
  const questionWordsArray = question.split(" ");

  
  var i = 0;
  
  for(i=0;i<questionWordsArray.length;i++) {

    if (Math.random() <= .20) {
      questionWordsArray[i] = "GULPIN";
    }
    
    
      document.getElementById("question").innerHTML += questionWordsArray[i] + " ";
      await speakText(questionWordsArray[i]);
  }
  
  const gulpinQuestion = document.getElementById("question").innerHTML;
  
  //speakText("Category is " + category + " . " + gulpinQuestion);
  
  for(i=0;i<4;i++) {
    document.getElementById("answer" + i).innerHTML = all_answers[i];
  }
}

function checkAnswer(int) {
  const selectedAnswer = document.getElementById("answer" + int).innerHTML;
  
  if (selectedAnswer == correctAnswer) {
    alert("correct!");
  } else {
    alert("incorrect!");
  }
  
}

function decode(val) {
  const text = document.createElement("textarea");
  text.innerHTML = val;
  return text.value;
}

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
   }
  return array;
}

function playSound(url) {
   return new Promise(resolve => {
       const audio = new Audio(url);
       audio.onended = resolve;
       audio.onerror = resolve;
       audio.play().catch(resolve);
   });
}

function speakText(text) {
  if (text == "GULPIN") {
    
    playSound(soundURL);
    
  } else {

    return new Promise(resolve => {
     const utter = new SpeechSynthesisUtterance(text);
     // utterance.voice = voices[21];
     utter.onend = resolve;
     utter.onerror = resolve;
     speechSynthesis.speak(utter);
    });
  }
}

function sleep(ms) {
   return new Promise(resolve => setTimeout(resolve, ms));
}



loadQuestion();

</script>
</body>
</html>
